<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
	<div th:replace="fragments/header :: header"></div>
	<div th:replace="fragments/search :: search"></div>
	<div id="content" class="registration-login-form">
	
	
		<script type="text/javascript" >
				function checkEmailAlreadyExists(email,id) {
					$.ajax({
						type : "POST",
						url : "/otomoto/user/checkEmailAlreadyExists",
						timeout : 5000,
						data: { 
							'id': id,
							'email': email 
						  },
						success : function(result) {
							if(result == true)
								$('#emailAlreadyExists').css('display','block');
							else
								$('#emailAlreadyExists').css('display','none');
						},
						error : function(result) {
							console.error("checkEmailAlreadyExists: ",  result);
						}
					});
				}
				
				function checkLoginAlreadyExists(login) {
					$.ajax({
						type : "POST",
						url : "/otomoto/user/checkLoginAlreadyExists",
						timeout : 5000,
						data: { 
							'login': login 
						  },
						success : function(result) {
							if(result == true)
								$('#loginAlreadyExists').css('display','block');
							else
								$('#loginAlreadyExists').css('display','none');
						},
						error : function(result) {
							console.error("checkLoginAlreadyExists: ",  result);
						}
					});
				}
				
			
			</script>
	
	
	
		
<!-- 		<p> 
			<a th:href="@{/user/list}" th:text="#{back}" style="float:left;"></a>
		</p> -->
		<!-- <div th:if="${message}" th:text="${message}"></div> -->
	<!-- 	<form th:if="*{id} != null" th:action="@{/user/insertOrUpdate}" th:object="${user}" method="post" class="userRegistrationForm"> -->
		<form  th:action="@{*{id} != null ? '/user/update' : '/user/insert'}" th:object="${user}" method="post" class="userRegistrationForm">
			
			<!-- <span th:if="${#fields.hasErrors('all')}" th:errors="*{all}"></span> -->
			<!-- <span th:if="${#fields.hasErrors('all')}" th:errors="*{all}"></span>
		 -->
			<!-- 			     <p th:each="error: ${#fields.errors('password')}"
         				 th:text="${password}">Validation error</p> -->

			<!--    	<p th:if="${#fields.hasErrors('password')}"
         				 th:text="${password}">Validation error</p> -->


			<table style="text-align: left; margin: auto; text-align:left;">
				<tr style="line-height: 45px;">
					<td><a th:href="@{/user/list}" th:text="#{back}" ></a></td>
					<td colspan="2"><span th:if="*{id} != null" th:text="#{userEdit}" ></span>
					<span th:if="*{id} == null" th:text="#{createUser}" ></span>
					</td>
				</tr>
				<tr th:if="*{id} != null">
					<td><label for="login">login</label></td>
					<td><input id="login" type="text" th:field="*{login}" readOnly="readOnly" style="border:none;" /></td>
				</tr>
				<tr th:if="*{id} == null">
					<td><label for="login">login</label></td>
					<td><input id="login" type="text" th:field="*{login}" onchange="checkLoginAlreadyExists(this.value);"  />
						<p id="loginAlreadyExists" style="display:none;" class="valiationError" th:text="#{loginAlreadyExists}"></p>
						<p th:if="${loginAlreadyExists}" class="valiationError" th:text="#{loginAlreadyExists}"></p>
						<p th:each="error: ${#fields.errors('login')}" class="valiationError" th:text="${error}"></p>
					</td> 
				</tr>
				<tr>
					<td><label for="email" th:text="#{email}"></label></td>
					<td><input id="email" type="email" th:field="*{email}" onkeyup="checkEmailAlreadyExists(this.value, document.getElementById('userId').value);" />
						<p  id="emailAlreadyExists" th:style="${emailAlreadyExists} == null ? 'display:none' : 'display:block'" th:text="#{emailAlreadyExists}" class="valiationError" ></p>
					<!-- 	<p th:if="${emailAlreadyExists}" th:text="#{emailAlreadyExists}" class="valiationError" ></p> -->
						<p th:each="error: ${#fields.errors('email')}" th:text="${error}" class="valiationError" ></p>
					</td>
				</tr>
				<tr th:if="*{id} == null">
					<td><label for="password" th:text="#{password}"></label></td>
					<td><input type="password" name="street" th:field="*{password}"/>
					<!-- <span class="valiationError" th:each="error: ${#fields.errors('password')}" th:text="#{incorrect.value}"></span> -->
					<p th:if="${passwordsAreNotSame}" th:text="#{passwordsAreNotSame}" class="valiationError" ></p>
					<p th:each="error: ${#fields.errors('password')}" th:text="${error}" class="valiationError" ></p>
					</td>
				</tr>
				<tr th:if="*{id} == null">
					<td><label for="passwordConfirm" th:text="#{passwordConfirm}"></label></td>
					<td><input type="password" name="street" th:field="*{passwordConfirm}"/>
					<p th:if="${validationFieldIsEmpty}" th:text="#{fieldIsEmpty}" class="valiationError" ></p>
					</td>
				</tr>
				<tr>
					<td><label for="city" th:text="#{city}"></label></td>
					<td><input type="text" name="city" th:field="*{city}"/>
					<span class="valiationError" th:each="error: ${#fields.errors('city')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="firstName" th:text="#{firstName}"></label></td>
					<td><input type="text" name="firstName" th:field="*{firstName}"/>
					<span class="valiationError" th:each="error: ${#fields.errors('firstName')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="lastName" th:text="#{lastName}"></label></td>
					<td><input type="text" name="lastName" th:field="*{lastName}"/>
					<span class="valiationError" th:each="error: ${#fields.errors('lastName')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="phoneNumber" th:text="#{phoneNumber}"></label></td>
					<td><input type="number" name="phoneNumber" th:field="*{phoneNumber}"/>
						<span class="valiationError" th:each="error: ${#fields.errors('phoneNumber')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="street" th:text="#{street}"></label></td>
					<td><input type="text" name="street" th:field="*{street}"/>
					<span class="valiationError" th:each="error: ${#fields.errors('street')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="zipCode" th:text="#{zipCode}" ></label></td>
					<td><input type="text" pattern="[0-9]{2}\-[0-9]{3}" name="zipCode" th:field="*{zipCode}"  />
					<span class="valiationError" th:each="error: ${#fields.errors('zipCode')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="active" th:text="#{active}"></label></td>
					<td><input type="checkbox" name="active" th:field="*{active}"/>
					<span class="valiationError" th:each="error: ${#fields.errors('active')}" th:text="#{incorrect.value}"></span>
					</td>
				</tr>
				<tr>
					<td><label for="description" th:text="#{description}"></label></td>
					<td colspan="2">
						<textarea rows="4" cols="40" name="description" th:field="*{description}">
						</textarea>
					</td>
				</tr>
				<tr>
					<td>
						<a th:href="@{'/user/delete/' + ${id}}"  th:text="usun"></a> 
						<!--  th:href="@{'/user/edit/' + ${user.id}}" -->
						<a th:href="@{'/user/changePass/' + ${id}}"  th:text="changePass"></a>
					</td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td><input type="hidden" th:field="*{id}" id="userId" /></td>
				</tr>
				<tr>
					<td></td>
					<td style="text-align: right;"><a
						class="remove-link-decoration" style="color: black;"
						th:href="@{/user/list/}" th:text="#{cancel}"></a><input style="margin-left: 10px;"
						type="submit" th:value="#{save}" /></td>
					<td></td>
				</tr>
				<tr>
					<td><input id="returnPage" name="returnPage" type="text"
						th:value="${returnPage}" /></td>
				</tr>
				<tr>
					<!-- 	<td>
					     <p th:each="e : ${#fields.detailedErrors()}" >
		            	<span th:text="${e.global}? '*' : ${e.fieldName}">The field name</span> |
					            <span th:text="${e.message}">The error message</span>
		      	 	 </p>
		      	 	 </td>
				</tr>  -->
			</table>

		</form>

	</div>
	<div th:replace="fragments/footer :: footer"></div>
</body>
</html>