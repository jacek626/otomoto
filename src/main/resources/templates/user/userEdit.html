<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
<div th:replace="fragments/header :: header"></div>
<div th:replace="fragments/search :: search"></div>


<div th:class="container">


    <script type="text/javascript">
        function checkEmailAlreadyExists(email, id) {
            $.ajax({
                type: "POST",
                url: "/otomoto/user/checkEmailAlreadyExists",
                timeout: 5000,
                data: {
                    id,
							email
						},
						success(result) {
							if (result === true)
								$("#emailAlreadyExists").css("display", "block");
							else
								$("#emailAlreadyExists").css("display", "none");
						},
						error: function (jqXHR, textStatus, errorThrown) {
							showError(errorThrown);
						}
					});
				}
				
				function checkLoginAlreadyExists(login) {
					$.ajax({
						type: "POST",
						url: "/otomoto/user/checkLoginAlreadyExists",
						timeout: 5000,
						data: {
							login
						},
						success(result) {
							if (result === true)
								$("#loginAlreadyExists").css("display", "block");
							else
                                $("#loginAlreadyExists").css("display", "none");
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            showError(errorThrown);
                        }
                    });
                }


    </script>

    <div class="text-center">
        <h5 th:if="*{id} != null" th:text="#{userEdit}"></h5>
        <h5 th:if="*{id} == null" th:text="#{createUser}"></h5>
    </div>

    <form method="post" th:action="@{*{id} != null ? '/user/update' : '/user/insert'}" th:object="${user}">

        <table class="m-auto">
            <tr th:if="*{id} != null">
                <td><label for="login">login</label></td>
                <td><input id="login" type="text" th:field="*{login}" readOnly="readOnly" style="border:none;"/></td>
            </tr>
            <tr th:if="*{id} == null">
                <td><label for="login">login</label></td>
                <td><input id="login" type="text" th:field="*{login}" onchange="checkLoginAlreadyExists(this.value);"/>
                    <p class="validationError" id="loginAlreadyExists" style="display:none;"
                       th:text="#{loginAlreadyExists}"></p>
                    <p class="validationError" th:if="${loginAlreadyExists}" th:text="#{loginAlreadyExists}"></p>
                    <p class="validationError" th:each="error: ${#fields.errors('login')}" th:text="${error}"></p>
                </td>
				</tr>
				<tr>
					<td><label for="email" th:text="#{email}"></label></td>
                    <td><input id="email" type="email" th:field="*{email}"
                               onkeyup="checkEmailAlreadyExists(this.value, document.getElementById('userId').value);"/>
                        <p class="validationError" id="emailAlreadyExists"
                           th:style="${emailAlreadyExists} == null ? 'display:none' : 'display:block'"
                           th:text="#{emailAlreadyExists}"></p>
                        <!-- 	<p th:if="${emailAlreadyExists}" th:text="#{emailAlreadyExists}" class="valiationError" ></p> -->
                        <p class="validationError" th:each="error: ${#fields.errors('email')}" th:text="${error}"></p>
                    </td>
				</tr>
            <tr th:if="*{id} == null">
                <td><label for="password" th:text="#{password}"></label></td>
                <td><input id="password" name="street" th:field="*{password}" type="password"/>
                    <!-- <span class="valiationError" th:each="error: ${#fields.errors('password')}" th:text="#{incorrect.value}"></span> -->
                    <p class="validationError" th:if="${passwordsAreNotSame}" th:text="#{passwordsAreNotSame}"></p>
                    <p class="validationError" th:each="error: ${#fields.errors('password')}" th:text="${error}"></p>
                </td>
            </tr>
            <tr th:if="*{id} == null">
                <td><label for="passwordConfirm" th:text="#{passwordConfirm}"></label></td>
                <td><input id="passwordConfirm" name="street" th:field="*{passwordConfirm}" type="password"/>
                    <p class="validationError" th:if="${validationFieldIsEmpty}" th:text="#{fieldIsEmpty}"></p>
                </td>
            </tr>
            <tr>
                <td><label for="city" th:text="#{city}"></label></td>
                <td><input id="city" th:field="*{city}" type="text"/>
                    <span class="validationError" th:each="error: ${#fields.errors('city')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
            <tr>
                <td><label for="firstName" th:text="#{firstName}"></label></td>
                <td><input id="firstName" th:field="*{firstName}" type="text"/>
                    <span class="validationError" th:each="error: ${#fields.errors('firstName')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
            <tr>
                <td><label for="lastName" th:text="#{lastName}"></label></td>
                <td><input id="lastName" th:field="*{lastName}" type="text"/>
                    <span class="validationError" th:each="error: ${#fields.errors('lastName')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
            <tr>
                <td><label for="phoneNumber" th:text="#{phoneNumber}"></label></td>
                <td><input id="phoneNumber" th:field="*{phoneNumber}" type="number"/>
                    <span class="validationError" th:each="error: ${#fields.errors('phoneNumber')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
            <tr>
                <td><label for="street" th:text="#{street}"></label></td>
                <td><input id="street" th:field="*{street}" type="text"/>
                    <span class="validationError" th:each="error: ${#fields.errors('street')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
            <tr>
                <td><label for="zipCode" th:text="#{zipCode}"></label></td>
                <td><input id="zipCode" pattern="[0-9]{2}\-[0-9]{3}" th:field="*{zipCode}" type="text"/>
                    <span class="validationError" th:each="error: ${#fields.errors('zipCode')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
				<tr>
					<td><label for="province">wojewodztwo</label></td>
					<td>
						<select id="province" th:field="*{province}">
						    <option th:each="province : ${T(com.app.enums.Province).values()}"
						            th:value="${province}"
						            th:text="#{__${province}__}"
						            th:selected="*{province}">
						    </option>
						</select>
					</td>
				</tr>
            <tr>
                <td><label for="active" th:text="#{active}"></label></td>
                <td><input id="active" th:field="*{active}" type="checkbox"/>
                    <span class="validationError" th:each="error: ${#fields.errors('active')}"
                          th:text="#{incorrect.value}"></span>
                </td>
            </tr>
				<tr>
					<td><label for="description" th:text="#{description}"></label></td>
                    <td colspan="2">
						<textarea cols="40" id="description" rows="4" th:field="*{description}">
						</textarea>
                    </td>
				</tr>
				<tr>
					<td></td>
					<td><input type="hidden" th:field="*{id}" id="userId" /></td>
				</tr>
            <tr>
                <td></td>
                <td class="text-right">
                    <a class="btn btn-primary" th:href="@{'/user/delete/' + ${id}}" th:text="usun"></a>
                    <a class="btn btn-primary" th:href="@{'/user/changePass/' + ${id}}" th:text="changePass"></a>
                    <button class="btn btn-primary" th:text="#{save}" type="submit"/>
                </td>
                <td></td>
            </tr>
				<tr>
					<!-- 	<td>
					     <p th:each="e : ${#fields.detailedErrors()}" >
		            	<span th:text="${e.global}? '*' : ${e.fieldName}">The field name</span> |
					            <span th:text="${e.message}">The error message</span>
		      	 	 </p>
		      	 	 </td>
				</tr>  -->
			</table>

		</form>

	</div>
	<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
